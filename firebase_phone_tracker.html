<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Location Tracker - Real Time</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header p {
            color: #666;
            font-size: 1.1em;
        }

        .status {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-top: 15px;
            animation: pulse 2s infinite;
        }

        .status.online {
            background: #10b981;
            color: white;
        }

        .status.waiting {
            background: #f59e0b;
            color: white;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .setup-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .setup-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .api-key-box {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .api-key-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 10px;
            margin-bottom: 15px;
            font-family: monospace;
        }

        .api-key-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: #10b981;
        }

        .btn-success:hover {
            background: #059669;
        }

        .code-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .code-box .comment {
            color: #6a9955;
        }

        .code-box .keyword {
            color: #569cd6;
        }

        .code-box .string {
            color: #ce9178;
        }

        .locations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .location-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
            border-left: 5px solid #667eea;
        }

        .location-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .location-card.latest {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #fff 0%, #f0fdf4 100%);
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .location-badge {
            background: #10b981;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .location-time {
            color: #666;
            font-size: 0.95em;
        }

        .location-coords {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 0.95em;
        }

        .location-coords div {
            margin: 5px 0;
        }

        .location-coords strong {
            color: #667eea;
        }

        .map-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: block;
            text-align: center;
        }

        .map-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.95em;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .locations-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                üìç Phone Location Tracker
            </h1>
            <p>Real-time location tracking with Firebase</p>
            <span class="status waiting" id="status">‚è≥ Waiting for location...</span>
        </div>

        <div class="setup-section" id="setupSection">
            <h2>üîê Setup Your Tracker</h2>
            <div class="alert alert-info">
                <strong>Step 1:</strong> Neeche ek unique secret key banao (minimum 8 characters)
            </div>
            <div class="api-key-box">
                <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #333;">
                    Secret Key (Phone se location bhejte waqt ye key use hogi)
                </label>
                <input type="text" id="secretKey" class="api-key-input" placeholder="Jaise: MyPhone2024@Secure" />
                <button class="btn" onclick="saveSecretKey()">‚úÖ Save & Activate Tracker</button>
            </div>
        </div>

        <div class="setup-section" id="instructionsSection" style="display: none;">
            <h2>üì± Phone Setup Instructions</h2>
            
            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Important:</strong> Apne phone mein Tasker ya MacroDroid app install karo (automation ke liye)
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #333;">Option 1: Tasker App (Recommended)</h3>
            <div class="code-box">
<span class="comment">// Profile Setup</span>
<span class="keyword">Event:</span> Phone ‚Üí Received Text
<span class="keyword">Sender:</span> * (any number)
<span class="keyword">Content:</span> <span class="string">TRACK123</span>

<span class="comment">// Task: Send Location to Firebase</span>
<span class="keyword">Action 1:</span> Location ‚Üí Get Location v2
  - Source: GPS
  - Timeout: 30 seconds

<span class="keyword">Action 2:</span> Net ‚Üí HTTP Request
  - Method: <span class="string">POST</span>
  - URL: <span class="string" id="firebaseUrl"></span>
  - Content Type: <span class="string">application/json</span>
  - Body:
    {
      <span class="string">"latitude"</span>: %gl_latitude,
      <span class="string">"longitude"</span>: %gl_longitude,
      <span class="string">"secret"</span>: <span class="string" id="secretKeyDisplay"></span>,
      <span class="string">"timestamp"</span>: %TIMES
    }
            </div>

            <h3 style="margin: 20px 0 10px 0; color: #333;">Option 2: MacroDroid (Free Alternative)</h3>
            <div class="code-box">
<span class="comment">// Macro Setup</span>
<span class="keyword">Trigger:</span> SMS Received
  - Content Contains: <span class="string">TRACK123</span>

<span class="keyword">Action:</span> HTTP Request
  - Method: <span class="string">POST</span>
  - URL: <span class="string" id="firebaseUrl2"></span>
  - Add Header: Content-Type: application/json
  - Request Body:
    {
      <span class="string">"latitude"</span>: {latitude},
      <span class="string">"longitude"</span>: {longitude},
      <span class="string">"secret"</span>: <span class="string" id="secretKeyDisplay2"></span>,
      <span class="string">"timestamp"</span>: {timestamp}
    }
            </div>

            <div class="alert alert-success">
                <strong>‚úÖ Testing:</strong> Setup ke baad apne phone ko ek SMS bhejo: <strong>"TRACK123"</strong>
                <br>Kuch seconds mein location yaha appear ho jayega!
            </div>
        </div>

        <div class="setup-section" id="dashboardSection" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üìä Location Dashboard</h2>
                <button class="btn btn-danger" onclick="resetTracker()">üîÑ Reset Tracker</button>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">Total Locations</div>
                    <div class="stat-number" id="totalCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Last Updated</div>
                    <div class="stat-number" id="lastUpdate" style="font-size: 1.2em;">-</div>
                </div>
            </div>

            <div id="locationsContainer"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB88zY0tUixDtUZXKHGeOzDegKc4UJ7bDg",
            authDomain: "location-tracking-8c706.firebaseapp.com",
            databaseURL: "https://location-tracking-8c706-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "location-tracking-8c706",
            storageBucket: "location-tracking-8c706.firebasestorage.app",
            messagingSenderId: "41761576194",
            appId: "1:41761576194:web:d8991105b7c7b80606de1b",
            measurementId: "G-J98HGKDFQ4"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let secretKey = localStorage.getItem('trackerSecretKey');
        let userId = localStorage.getItem('trackerId') || generateId();
        localStorage.setItem('trackerId', userId);

        // Check if already setup
        if (secretKey) {
            showDashboard();
        }

        function generateId() {
            return 'user_' + Math.random().toString(36).substr(2, 9);
        }

        function saveSecretKey() {
            const key = document.getElementById('secretKey').value.trim();
            
            if (key.length < 8) {
                alert('‚ùå Secret key kam se kam 8 characters ka hona chahiye!');
                return;
            }

            secretKey = key;
            localStorage.setItem('trackerSecretKey', secretKey);
            
            showDashboard();
        }

        function showDashboard() {
            document.getElementById('setupSection').style.display = 'none';
            document.getElementById('instructionsSection').style.display = 'block';
            document.getElementById('dashboardSection').style.display = 'block';

            // Update Firebase URL in instructions
            const fbUrl = `${firebaseConfig.databaseURL}/locations/${userId}.json`;
            document.getElementById('firebaseUrl').textContent = fbUrl;
            document.getElementById('firebaseUrl2').textContent = fbUrl;
            document.getElementById('secretKeyDisplay').textContent = `"${secretKey}"`;
            document.getElementById('secretKeyDisplay2').textContent = `"${secretKey}"`;

            // Start listening for locations
            listenForLocations();
        }

        function listenForLocations() {
            const locationsRef = database.ref('locations/' + userId);
            
            locationsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                
                if (!data) {
                    document.getElementById('locationsContainer').innerHTML = `
                        <div class="empty-state">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <h3>Koi location abhi tak receive nahi hua</h3>
                            <p>Phone se "TRACK123" SMS bhejo to location yaha appear hoga</p>
                        </div>
                    `;
                    return;
                }

                const locations = Object.entries(data)
                    .map(([key, value]) => ({ id: key, ...value }))
                    .filter(loc => loc.secret === secretKey)
                    .sort((a, b) => b.timestamp - a.timestamp);

                if (locations.length === 0) {
                    document.getElementById('locationsContainer').innerHTML = `
                        <div class="alert alert-warning">
                            ‚ö†Ô∏è Location receive ho rahe hain lekin secret key match nahi ho rahi. 
                            Phone setup check karo!
                        </div>
                    `;
                    return;
                }

                document.getElementById('status').textContent = '‚úÖ Connected';
                document.getElementById('status').className = 'status online';
                document.getElementById('totalCount').textContent = locations.length;
                document.getElementById('lastUpdate').textContent = formatTime(locations[0].timestamp);

                displayLocations(locations);
            });
        }

        function displayLocations(locations) {
            const container = document.getElementById('locationsContainer');
            
            const html = `
                <div class="locations-grid">
                    ${locations.map((loc, index) => `
                        <div class="location-card ${index === 0 ? 'latest' : ''}">
                            <div class="location-header">
                                <div class="location-time">
                                    üïê ${formatFullTime(loc.timestamp)}
                                </div>
                                ${index === 0 ? '<span class="location-badge">Latest</span>' : ''}
                            </div>
                            <div class="location-coords">
                                <div><strong>Latitude:</strong> ${loc.latitude.toFixed(6)}</div>
                                <div><strong>Longitude:</strong> ${loc.longitude.toFixed(6)}</div>
                            </div>
                            <a href="https://www.google.com/maps?q=${loc.latitude},${loc.longitude}" 
                               target="_blank" 
                               class="map-btn">
                                üó∫Ô∏è Google Maps ‡§™‡§∞ ‡§¶‡•á‡§ñ‡•á‡§Ç
                            </a>
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = html;
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000); // seconds

            if (diff < 60) return diff + 's ago';
            if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
            if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
            return Math.floor(diff / 86400) + 'd ago';
        }

        function formatFullTime(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleString('hi-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });
        }

        function resetTracker() {
            if (confirm('‚ö†Ô∏è Kya aap sure hain? Saara data delete ho jayega!')) {
                localStorage.removeItem('trackerSecretKey');
                localStorage.removeItem('trackerId');
                
                // Delete Firebase data
                database.ref('locations/' + userId).remove();
                
                location.reload();
            }
        }
    </script>
</body>
</html>